version: "3.1"

intents:
  - greet
  - goodbye
  - help
  - request_field_recommendation
  - ask_reservation_process
  - ask_modify_reservation
  - ask_cancellation_policy
  - ask_pricing_info
  - show_previous_recommendations
  - ask_feedback_status
  - show_faqs
  - human_handoff
  - affirm
  - deny

entities:
  - sport
  - location
  - surface
  - date
  - time
  - budget
  - skill_level
  - user_id

slots:
  user_id:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: user_id
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: user_id
          - active_loop: feedback_status_form
            requested_slot: user_id
  chatbot_session_id:
    type: text
    influence_conversation: false
    mappings:
      - type: custom
  chat_theme:
    type: text
    influence_conversation: false
    initial_value: "Reservas y alquileres"
    mappings:
      - type: custom
  preferred_sport:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: sport
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_sport
  preferred_location:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: location
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_location
  preferred_surface:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: surface
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_surface
  preferred_date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: date
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_date
  preferred_start_time:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: time
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_start_time
  preferred_end_time:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: time
      - type: from_text
        conditions:
          - active_loop: field_recommendation_form
            requested_slot: preferred_end_time
  preferred_budget:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: budget
  preferred_skill_level:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: skill_level
  feedback_rating:
    type: categorical
    influence_conversation: false
    values:
      - thumbs_up
      - thumbs_down
    mappings:
      - type: from_llm
  confirm_human_handoff:
    type: categorical
    influence_conversation: false
    values:
      - "Sí"
      - "No"
    mappings:
      - type: from_llm
  example_questions:
    type: text
    influence_conversation: false
    initial_value: |
      - ¿Qué puedes hacer?
      - Muéstrame mis recomendaciones anteriores
      - Conéctame con un agente humano
    mappings:
      - type: controlled
  agent_name:
    type: text
    influence_conversation: false
    initial_value: "Chato Bot"
    mappings:
      - type: controlled

forms:
  field_recommendation_form:
    required_slots:
      - user_id
      - preferred_sport
      - preferred_date
      - preferred_start_time
      - preferred_location
      - preferred_surface
  feedback_status_form:
    required_slots:
      - user_id

responses:
  utter_hello:
    - text: "¡Hola! Soy Chato Bot, tu asistente de PichangApp listo para ayudarte con reservas y recomendaciones."
      metadata:
        rephrase: True
    - text: "¡Bienvenido! Soy Chato Bot. ¿Listo para encontrar la mejor cancha para tu partido?"
    - text: "¡Hola! Chato Bot a tu servicio. Cuéntame qué necesitas y buscaremos la mejor opción disponible."
  utter_goodbye:
    - text: "¡Gracias por contactarnos! Que tengas un gran partido."
    - text: "¡Hasta pronto! Si necesitas otra reserva, aquí estaré."
    - text: "Listo, cualquier cosa vuelve a escribirme. ¡Éxitos en la cancha!"
    - text: "Gracias por usar PichangApp. ¡Nos vemos!"
    - text: "¡Cuídate! Estoy disponible cuando quieras organizar otro encuentro."
  utter_what_can_you_do:
    - text: |
        Puedo ayudarte a:
        - Buscar canchas disponibles según tus preferencias.
        - Explicarte cómo reservar, modificar o cancelar.
        - Mostrarte tu historial de recomendaciones y feedback.
        - Conectarte con un agente humano si lo necesitas.
      metadata:
        rephrase: True
  utter_ask_field_recommendation_form_user_id:
    - text: "Para buscar canchas necesito tu ID de usuario en PichangApp. ¿Cuál es?"
  utter_ask_field_recommendation_form_preferred_sport:
    - text: "¿Qué deporte deseas jugar?"
  utter_ask_field_recommendation_form_preferred_date:
    - text: "¿Para qué fecha necesitas la cancha? (formato AAAA-MM-DD)"
  utter_ask_field_recommendation_form_preferred_start_time:
    - text: "¿A qué hora te gustaría empezar? (por ejemplo 19:00)"
  utter_ask_field_recommendation_form_preferred_location:
    - text: "¿En qué distrito o zona prefieres jugar?"
  utter_ask_field_recommendation_form_preferred_surface:
    - text: "¿Tienes preferencia por alguna superficie (sintético, grass, etc.)?"
  utter_ask_feedback_status_form_user_id:
    - text: "Perfecto, dime tu ID de usuario para revisar tus comentarios."
  utter_reservation_process:
    - text: |
        Para reservar una cancha solo debes:
        1. Elegir el deporte y la sede que prefieras.
        2. Seleccionar fecha y horario disponibles.
        3. Confirmar la reserva y realizar el pago desde la app.
        Si necesitas ayuda en algún paso, ¡dímelo!
  utter_modify_reservation:
    - text: |
        Puedes modificar tu reserva desde la sección "Mis reservas" eligiendo una nueva fecha u hora disponible.
        Si la reserva ya está muy cerca, es posible que necesites apoyo del equipo de soporte.
  utter_cancellation_policy:
    - text: |
        Las cancelaciones se permiten hasta 24 horas antes del horario reservado.
        Si cancelas dentro de ese plazo, el saldo queda como crédito para tu siguiente reserva.
        Fuera de ese tiempo, contáctanos para revisar tu caso.
  utter_pricing_info:
    - text: |
        El precio de cada cancha depende del deporte, la sede y la franja horaria.
        Cuando busques opciones te mostraré el costo por hora y promociones disponibles.
  utter_top_faqs:
    - text: |
        Puedes preguntarme sobre:

        - 📅 ¿Cómo reservo una cancha?
        - 🔁 ¿Puedo cambiar o cancelar una reserva?
        - 💸 ¿Cuánto cuesta jugar en determinada sede?
        - ⭐ ¿Cómo dejar feedback de mis partidos?
        - 🧑‍🤝‍🧑 ¿Cómo contacto a un agente humano?
      metadata:
        rephrase: True
  utter_ask_feedback_rating:
    - text: "¿Cómo calificarías tu experiencia?"
      buttons:
        - title: "👍 Excelente"
          payload: "/SetSlots(feedback_rating=thumbs_up)"
        - title: "👎 Podría mejorar"
          payload: "/SetSlots(feedback_rating=thumbs_down)"
  utter_thankyou_positive:
    - text: "¡Gracias por el comentario positivo! Seguiremos mejorando para ti."
    - text: "¡Genial! Nos alegra saber que disfrutaste el servicio."
    - text: "¡Muchas gracias! Tus buenos comentarios nos motivan a seguir creciendo."
  utter_thankyou_negative:
    - text: "Gracias por tu sinceridad. Revisaremos cómo mejorar tu próxima experiencia."
    - text: "Apreciamos tu feedback. Trabajaremos para ofrecerte un mejor servicio."
    - text: "Gracias por avisarnos. Tu comentario nos ayuda a mejorar."
  utter_ask_confirm_human_handoff:
    - text: "¿Quieres que te conecte con un agente humano?"
      buttons:
        - payload: "/SetSlots(confirm_human_handoff=Sí)"
          title: "Sí, por favor"
        - payload: "/SetSlots(confirm_human_handoff=No)"
          title: "No, gracias"
  utter_transferring_to_human:
    - text: "Listo, te voy a derivar con un agente humano en unos momentos."
  utter_human_handoff_cancelled:
    - text: "Entendido, seguimos por aquí. ¿Hay algo más en lo que pueda ayudarte?"
      metadata:
        rephrase: True
  utter_transfer_to_manager:
    - text: "Voy a compartir el siguiente resumen de la conversación con el equipo de soporte:\n{summary}"
  utter_default_fallback:
    - text: "No estoy seguro de haber entendido. ¿Podrías reformular tu mensaje o darme más detalles?"
  utter_no_relevant_answer_found:
    - text: "Lo siento, por ahora no tengo una respuesta para eso. ¿Quieres intentarlo con otra pregunta?"
      metadata:
        rephrase: True
  utter_welcome:
    - text: |
        ¡Hola! Soy {agent_name} 👋. Estoy aquí para ayudarte con tus reservas deportivas.

        Puedes empezar con preguntas como:
        {example_questions}
  utter_help:
    - text: "¿En qué puedo ayudarte?"
      metadata:
        rephrase: True

actions:
  - action_submit_field_recommendation_form
  - action_show_recommendation_history
  - action_check_feedback_status
  - action_close_chat_session
  - action_human_handoff

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

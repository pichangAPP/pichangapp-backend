# ===========================================
# ğŸ§  BASE: Imagen oficial de Rasa Pro
# ===========================================
FROM rasa/rasa-pro:3.12.3

# Trabajaremos como root para poder instalar dependencias
USER root
WORKDIR /app

# ===========================================
# ğŸ“¦ Instalar dependencias adicionales
# (FastAPI, psycopg2, SQLAlchemy, etc.)
# ===========================================
COPY requirements.txt /app/requirements.txt

RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r /app/requirements.txt

# ===========================================
# ğŸ“ Copiar TODO tu proyecto dentro del contenedor
# Incluye domain, actions, config, endpoints, FastAPI, etc.
# ===========================================
COPY . /app

# Asegurar permisos del entrypoint
RUN chmod +x /app/entrypoint.sh

# ===========================================
# ğŸŒ Exponer puertos
# -------------------------------------------
# 5005 â†’ Rasa NLU/Core API
# 5055 â†’ Action Server
# 8006 â†’ FastAPI
# ===========================================
EXPOSE 5005 5055 8006

# ===========================================
# ğŸš€ ENTRYPOINT
# ===========================================
ENTRYPOINT ["bash", "/app/entrypoint.sh"]
